<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Introduction to Design Time Templating in C# &#8211; </title>
<meta name="description" content="">
<meta name="keywords" content="c#, T4">



<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Introduction to Design Time Templating in C#">
<meta property="og:description" content="">
<meta property="og:url" content="/metaprogramming/2013/04/17/introduction-to-design-time-templating-in-c.html">
<meta property="og:site_name" content="">
<meta property="og:image" content="/images/">





<link rel="canonical" href="/metaprogramming/2013/04/17/introduction-to-design-time-templating-in-c.html">
<link href="/feed.xml" type="application/atom+xml" rel="alternate" title=" Feed">


<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

    
    <link rel="stylesheet" type="text/css" href="/assets/css/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="/assets/css/style.css" />






<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/images/apple-touch-icon-144x144-precomposed.png">

</head>
<body class="post-template" itemscope itemtype="http://schema.org/WebPage">  

<header id="masthead" class="blog-background overlay align-center align-middle animated from-bottom"  style="background-image: url(/images/)" itemscope itemtype="http://schema.org/Organization">


    <div class="inner">
        <div class="container">
            <a class="brand" href="/" role="banner" itemprop="url">

                

            <h1 class="blog-title light" itemprop="name">
                
            </h1>
                
            </a>
        </div>
    </div>
    
    
    <div class="decor-wrapper">
        <svg id="header-decor" class="decor bottom" xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 100 100" preserveAspectRatio="none">
            <path d="M0 99.9 L50 49.9 L100 99.9 L0 99.9" fill="rgba(255,255,255, 1)"></path>

            <path d="M48 52 L50 49 L52 52 L48 52" fill="rgba(255,255,255, 1)"></path>

        </svg>
    </div>
    
</header>
<div id="main" class="content" role="main" itemprop="mainContentOfPage" itemscope itemtype="http://schema.org/Blog">
    <div class="container">
        <div class="row">
            <article class="post col-md-8 col-md-offset-2 hentry" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
            
            
            
                
            
             
             
                    <header class="post-header entry-header">
                        
                        <h1 class="post-title text-center hyper lighter bordered-bottom entry-title" itemprop="headline">Introduction to Design Time Templating in C#</h1>
                        
                        <div class="post-info text-center small">
                            <span class="entry-date date published updated"><time datetime="2013-04-17T00:00:00+02:00" class="post-time" itemprop="datePublished">17 Apr 2013</time><span>
                            in <span class="post-tags"><a href="/categories/index.html#metaprogramming" data-toggle="tooltip" title="Other posts from the Metaprogramming category" rel="tag">Metaprogramming</a></span>
                        </div>
                    </header>
                    <div class="post-body bordered-bottom" itemprop="description">
                        
                        <p>While a good developer will always do their best to write DRY code, cases do arise when repetition is inevitable. Mapping one object type to another provides a good example of this. While reflection can be used to compare types against one another, in high-volume contexts the performance loss that reflection incurs may be too significant.</p>

<p>So, if we can’t use reflection to map one object to another, we need another way to accomplish this. We could write a direct mapper method, mapping one type to another manually, but this is a lot of work and requires us to update the mapper manually each time the classes change. This is where T4 templates come in. <a id='more' /><a id='more-92' /> T4 templates are files which when run generate some sort of textual output, usually code. They look a lot like .aspx files, and function in pretty much the exact same way.</p>

<p>Two types of T4 templates exist: runtime and design time. Runtime templates are executed while the program is running, exactly like .aspx files do, inserting dynamic data into a static skeleton. Design time templates do the same thing, but instead execute pre-compilation. This is an incredibly useful feature, because it allows us to generate C# code that will be error-checked by the compiler just as hand-written code would be. It is this solution that we are going to adopt to map our objects.</p>

<p>For this example we will use two objects, Person1 and Person2 which both look like the following:</p>
<div class='highlight'><pre><code class='csharp'><span class='k'>public</span> <span class='k'>class</span> <span class='nc'>Person1</span> <span class='c1'>// (Person2)</span>
<span class='p'>{</span>
    <span class='k'>public</span> <span class='kt'>string</span> <span class='n'>Name</span> <span class='p'>{</span> <span class='k'>get</span><span class='p'>;</span> <span class='k'>set</span><span class='p'>;</span> <span class='p'>}</span>
    <span class='k'>public</span> <span class='n'>DateTime</span> <span class='n'>Birthday</span> <span class='p'>{</span> <span class='k'>get</span><span class='p'>;</span> <span class='k'>set</span><span class='p'>;</span> <span class='p'>}</span>
<span class='p'>}</span>
</code></pre></div>
<p>Let’s get templating.</p>

<h1 id="creating_the_template">Creating the template</h1>

<p>When you create a T4 template in Visual Studio (they are found in the “General” section of the “Add New Item” window), the file by default contains the following six lines:</p>
<div class='highlight'><pre><code class='csharp'><span class='p'>&lt;</span><span class='err'>#@</span> <span class='n'>template</span> <span class='n'>debug</span><span class='p'>=</span><span class='s'>&quot;false&quot;</span> <span class='n'>hostspecific</span><span class='p'>=</span><span class='s'>&quot;false&quot;</span> <span class='n'>language</span><span class='p'>=</span><span class='s'>&quot;C#&quot;</span> <span class='err'>#</span><span class='p'>&gt;</span>
<span class='p'>&lt;</span><span class='err'>#@</span> <span class='n'>assembly</span> <span class='n'>name</span><span class='p'>=</span><span class='s'>&quot;System.Core&quot;</span> <span class='err'>#</span><span class='p'>&gt;</span>
<span class='p'>&lt;</span><span class='err'>#@</span> <span class='n'>import</span> <span class='n'>namespace</span><span class='p'>=</span><span class='s'>&quot;System.Linq&quot;</span> <span class='err'>#</span><span class='p'>&gt;</span>
<span class='p'>&lt;</span><span class='err'>#@</span> <span class='n'>import</span> <span class='n'>namespace</span><span class='p'>=</span><span class='s'>&quot;System.Text&quot;</span> <span class='err'>#</span><span class='p'>&gt;</span>
<span class='p'>&lt;</span><span class='err'>#@</span> <span class='n'>import</span> <span class='n'>namespace</span><span class='p'>=</span><span class='s'>&quot;System.Collections.Generic&quot;</span> <span class='err'>#</span><span class='p'>&gt;</span>
<span class='p'>&lt;</span><span class='err'>#@</span> <span class='n'>output</span> <span class='n'>extension</span><span class='p'>=</span><span class='s'>&quot;.txt&quot;</span> <span class='err'>#</span><span class='p'>&gt;</span>
</code></pre></div>
<p>The “template” declaration specifies whether debugging is enabled, the language in which the template is written, and whether the template is “host specific”. A host specific template allows access to a property called “Host” which enables several actions such as the resolution of filepaths. <a href="http://msdn.microsoft.com/en-us/library/microsoft.visualstudio.texttemplating.itexttemplatingenginehost.aspx">A full list of these actions can be found here</a>.</p>

<p>The “assembly” declaration points to assemblies which are loaded into the template. This is similar to adding a reference in a project.</p>

<p>The “import” statement functions just as a “using” statement does, importing namespaces into the template file. Because Intellisense is currently not supported by default in T4 templates, forgetting to import a namespace is a common error to make when writing a template.</p>

<p>Finally, the output statement specifies what format the outputted file should take. In our case we want this to be “.cs”.</p>

<h1 id="writing_the_template_logic">Writing the template logic</h1>

<p>Let’s start writing. We’ll start by writing a direct mapper in plain old C#, from which we can derive our template.</p>
<div class='highlight'><pre><code class='csharp'><span class='k'>namespace</span> <span class='nn'>MapperApplication</span>
<span class='p'>{</span>
    <span class='k'>public</span> <span class='k'>static</span> <span class='k'>class</span> <span class='nc'>Mapper</span>
    <span class='p'>{</span>
        <span class='k'>public</span> <span class='k'>static</span> <span class='n'>Person2</span> <span class='nf'>Map</span><span class='p'>(</span><span class='n'>Person1</span> <span class='n'>person1</span><span class='p'>)</span>
        <span class='p'>{</span>
            <span class='k'>return</span> <span class='k'>new</span> <span class='n'>Person2</span>
            <span class='p'>{</span>
                <span class='n'>Name</span> <span class='p'>=</span> <span class='n'>person1</span><span class='p'>.</span><span class='n'>Name</span><span class='p'>,</span>
                <span class='n'>Birthday</span> <span class='p'>=</span> <span class='n'>person1</span><span class='p'>.</span><span class='n'>Birthday</span>
            <span class='p'>};</span>
        <span class='p'>}</span>
    <span class='p'>}</span>
<span class='p'>}</span>
</code></pre></div>
<p>Now let’s start the template. All we are really trying to achieve for the sake of this example is to replace the two innermost lines of code with calculated output from our template. The rest will remain the same. Let’s start by writing the C# to produce these lines of code given the two types:</p>
<div class='highlight'><pre><code class='csharp'><span class='k'>const</span> <span class='kt'>string</span> <span class='n'>person1Name</span> <span class='p'>=</span> <span class='s'>&quot;person1&quot;</span><span class='p'>;</span>
<span class='k'>const</span> <span class='kt'>string</span> <span class='n'>person2Name</span> <span class='p'>=</span> <span class='s'>&quot;person2&quot;</span><span class='p'>;</span>
<span class='k'>const</span> <span class='kt'>string</span> <span class='n'>PropertyMapTemplate</span> <span class='p'>=</span> <span class='s'>&quot;{0} = {1}.{2}&quot;</span><span class='p'>;</span>

<span class='kt'>var</span> <span class='n'>type1</span> <span class='p'>=</span> <span class='k'>typeof</span><span class='p'>(</span><span class='n'>Person1</span><span class='p'>);</span>
<span class='kt'>var</span> <span class='n'>type2</span> <span class='p'>=</span> <span class='k'>typeof</span><span class='p'>(</span><span class='n'>Person2</span><span class='p'>);</span>

<span class='kt'>var</span> <span class='n'>person1Properties</span> <span class='p'>=</span> <span class='n'>type1</span><span class='p'>.</span><span class='n'>GetProperties</span><span class='p'>();</span>
<span class='kt'>var</span> <span class='n'>person2Properties</span> <span class='p'>=</span> <span class='n'>type2</span><span class='p'>.</span><span class='n'>GetProperties</span><span class='p'>();</span>

<span class='kt'>var</span> <span class='n'>mappings</span> <span class='p'>=</span> <span class='n'>person1Properties</span><span class='p'>.</span><span class='n'>Select</span><span class='p'>(</span><span class='n'>person1Property</span> <span class='p'>=&gt;</span>
<span class='p'>{</span>
    <span class='kt'>var</span> <span class='n'>person1PropertyName</span> <span class='p'>=</span> <span class='n'>person1Property</span><span class='p'>.</span><span class='n'>Name</span><span class='p'>;</span>
    <span class='kt'>var</span> <span class='n'>person2PropertyName</span> <span class='p'>=</span> <span class='n'>person2Properties</span>
        <span class='p'>.</span><span class='n'>First</span><span class='p'>(</span><span class='n'>person2Property</span> <span class='p'>=&gt;</span> <span class='n'>person2Property</span><span class='p'>.</span><span class='n'>Name</span> <span class='p'>==</span> <span class='n'>person1Property</span><span class='p'>.</span><span class='n'>Name</span>
            <span class='p'>&amp;</span><span class='n'>amp</span><span class='p'>;&amp;</span><span class='n'>amp</span><span class='p'>;</span> <span class='n'>person2Property</span><span class='p'>.</span><span class='n'>PropertyType</span> <span class='p'>==</span> <span class='n'>person1Property</span><span class='p'>.</span><span class='n'>PropertyType</span><span class='p'>)</span>
        <span class='p'>.</span><span class='n'>Name</span><span class='p'>;</span>

    <span class='k'>return</span> <span class='kt'>string</span><span class='p'>.</span><span class='n'>Format</span><span class='p'>(</span><span class='n'>PropertyMapTemplate</span><span class='p'>,</span> <span class='n'>person2PropertyName</span><span class='p'>,</span> <span class='n'>person1Name</span><span class='p'>,</span> <span class='n'>person1PropertyName</span><span class='p'>);</span>
<span class='p'>});</span>
</code></pre></div>
<p>Here we start by defining the name of each variable as it will appear in the generated code, as well as the format string for the mapping statement. We then get the properties of each type and then loop through them using a LINQ expression to get the formatted strings. The result of this when executed is that the mappings variable contains the following two elements</p>
<div class='highlight'><pre><code class='csharp'><span class='na'>[“Name = person1.Name”, “Birthday = person1.Birthday”]</span>
</code></pre></div>
<p>This then needs to be formatted to look like the two lines in our example. We do this with the following line:</p>
<div class='highlight'><pre><code class='csharp'><span class='kt'>var</span> <span class='n'>mappingDeclarations</span> <span class='p'>=</span> <span class='kt'>string</span><span class='p'>.</span><span class='n'>Join</span><span class='p'>(</span><span class='s'>&quot;,&quot;</span> <span class='p'>+</span> <span class='n'>Environment</span><span class='p'>.</span><span class='n'>NewLine</span> <span class='p'>+</span> <span class='s'>&quot;\t\t\t&quot;</span><span class='p'>,</span> <span class='n'>mappings</span><span class='p'>);</span>
</code></pre></div>
<p>Writing the template</p>

<p>Now we can finally get to writing the template itself. Because my Person1 and Person2 objects are declared in the current project, I need to add an assembly reference to the current project as well as an import statement to the appropriate namespace, “MapperApplication”.</p>
<div class='highlight'><pre><code class='csharp'><span class='p'>&lt;</span><span class='err'>#@</span> <span class='n'>template</span> <span class='n'>debug</span><span class='p'>=</span><span class='s'>&quot;false&quot;</span> <span class='n'>hostspecific</span><span class='p'>=</span><span class='s'>&quot;false&quot;</span> <span class='n'>language</span><span class='p'>=</span><span class='s'>&quot;C#&quot;</span> <span class='err'>#</span><span class='p'>&gt;</span>
<span class='p'>&lt;</span><span class='err'>#@</span> <span class='n'>assembly</span> <span class='n'>name</span><span class='p'>=</span><span class='s'>&quot;System.Core&quot;</span> <span class='err'>#</span><span class='p'>&gt;</span>
<span class='p'>&lt;</span><span class='err'>#@</span> <span class='n'>assembly</span> <span class='n'>name</span><span class='p'>=</span><span class='s'>&quot;$(TargetPath)&quot;</span> <span class='err'>#</span><span class='p'>&gt;</span>
<span class='p'>&lt;</span><span class='err'>#@</span> <span class='n'>import</span> <span class='n'>namespace</span><span class='p'>=</span><span class='s'>&quot;MapperApplication&quot;</span> <span class='err'>#</span><span class='p'>&gt;</span>
<span class='p'>&lt;</span><span class='err'>#@</span> <span class='n'>import</span> <span class='n'>namespace</span><span class='p'>=</span><span class='s'>&quot;System.Linq&quot;</span> <span class='err'>#</span><span class='p'>&gt;</span>
<span class='p'>&lt;</span><span class='err'>#@</span> <span class='n'>import</span> <span class='n'>namespace</span><span class='p'>=</span><span class='s'>&quot;System.Text&quot;</span> <span class='err'>#</span><span class='p'>&gt;</span>
<span class='p'>&lt;</span><span class='err'>#@</span> <span class='n'>import</span> <span class='n'>namespace</span><span class='p'>=</span><span class='s'>&quot;System.Collections.Generic&quot;</span> <span class='err'>#</span><span class='p'>&gt;</span>
<span class='p'>&lt;</span><span class='err'>#@</span> <span class='n'>output</span> <span class='n'>extension</span><span class='p'>=</span><span class='s'>&quot;.cs&quot;</span> <span class='err'>#</span><span class='p'>&gt;</span>
</code></pre></div>
<p>Now let’s go about inserting the logic we previously wrote into this template. We surround all code that we want to be executed with tags.</p>
<div class='highlight'><pre><code class='csharp'><span class='p'>&lt;</span><span class='err'>#@</span> <span class='n'>template</span> <span class='n'>debug</span><span class='p'>=</span><span class='s'>&quot;false&quot;</span> <span class='n'>hostspecific</span><span class='p'>=</span><span class='s'>&quot;false&quot;</span> <span class='n'>language</span><span class='p'>=</span><span class='s'>&quot;C#&quot;</span> <span class='err'>#</span><span class='p'>&gt;</span>
<span class='p'>&lt;</span><span class='err'>#@</span> <span class='n'>assembly</span> <span class='n'>name</span><span class='p'>=</span><span class='s'>&quot;System.Core&quot;</span> <span class='err'>#</span><span class='p'>&gt;</span>
<span class='p'>&lt;</span><span class='err'>#@</span> <span class='n'>assembly</span> <span class='n'>name</span><span class='p'>=</span><span class='s'>&quot;$(TargetPath)&quot;</span> <span class='err'>#</span><span class='p'>&gt;</span>
<span class='p'>&lt;</span><span class='err'>#@</span> <span class='n'>import</span> <span class='n'>namespace</span><span class='p'>=</span><span class='s'>&quot; MapperApplication &quot;</span> <span class='err'>#</span><span class='p'>&gt;</span>
<span class='p'>&lt;</span><span class='err'>#@</span> <span class='n'>import</span> <span class='n'>namespace</span><span class='p'>=</span><span class='s'>&quot;System.Linq&quot;</span> <span class='err'>#</span><span class='p'>&gt;</span>
<span class='p'>&lt;</span><span class='err'>#@</span> <span class='n'>import</span> <span class='n'>namespace</span><span class='p'>=</span><span class='s'>&quot;System.Text&quot;</span> <span class='err'>#</span><span class='p'>&gt;</span>
<span class='p'>&lt;</span><span class='err'>#@</span> <span class='n'>import</span> <span class='n'>namespace</span><span class='p'>=</span><span class='s'>&quot;System.Collections.Generic&quot;</span> <span class='err'>#</span><span class='p'>&gt;</span>
<span class='p'>&lt;</span><span class='err'>#@</span> <span class='n'>output</span> <span class='n'>extension</span><span class='p'>=</span><span class='s'>&quot;.cs&quot;</span> <span class='err'>#</span><span class='p'>&gt;</span>
<span class='p'>&lt;</span><span class='err'>#</span>
<span class='k'>const</span> <span class='kt'>string</span> <span class='n'>person1Name</span> <span class='p'>=</span> <span class='s'>&quot;person1&quot;</span><span class='p'>;</span>
<span class='k'>const</span> <span class='kt'>string</span> <span class='n'>person2Name</span> <span class='p'>=</span> <span class='s'>&quot;person2&quot;</span><span class='p'>;</span>
<span class='k'>const</span> <span class='kt'>string</span> <span class='n'>PropertyMapTemplate</span> <span class='p'>=</span> <span class='s'>&quot;{0} = {1}.{2}&quot;</span><span class='p'>;</span>

<span class='kt'>var</span> <span class='n'>type1</span> <span class='p'>=</span> <span class='k'>typeof</span><span class='p'>(</span><span class='n'>Person1</span><span class='p'>);</span>
<span class='kt'>var</span> <span class='n'>type2</span> <span class='p'>=</span> <span class='k'>typeof</span><span class='p'>(</span><span class='n'>Person2</span><span class='p'>);</span>
<span class='kt'>var</span> <span class='n'>person1Properties</span> <span class='p'>=</span> <span class='n'>type1</span><span class='p'>.</span><span class='n'>GetProperties</span><span class='p'>();</span>
<span class='kt'>var</span> <span class='n'>person2Properties</span> <span class='p'>=</span> <span class='n'>type2</span><span class='p'>.</span><span class='n'>GetProperties</span><span class='p'>();</span>

<span class='kt'>var</span> <span class='n'>mappings</span> <span class='p'>=</span> <span class='n'>person1Properties</span><span class='p'>.</span><span class='n'>Select</span><span class='p'>(</span><span class='n'>person1Property</span> <span class='p'>=&gt;</span>
<span class='p'>{</span>
    <span class='kt'>var</span> <span class='n'>person1PropertyName</span> <span class='p'>=</span> <span class='n'>person1Property</span><span class='p'>.</span><span class='n'>Name</span><span class='p'>;</span>
    <span class='kt'>var</span> <span class='n'>person2PropertyName</span> <span class='p'>=</span> <span class='n'>person2Properties</span>
        <span class='p'>.</span><span class='n'>First</span><span class='p'>(</span><span class='n'>person2Property</span> <span class='p'>=&gt;</span> <span class='n'>person2Property</span><span class='p'>.</span><span class='n'>Name</span> <span class='p'>==</span> <span class='n'>person1Property</span><span class='p'>.</span><span class='n'>Name</span>
            <span class='p'>&amp;</span><span class='n'>amp</span><span class='p'>;&amp;</span><span class='n'>amp</span><span class='p'>;</span> <span class='n'>person2Property</span><span class='p'>.</span><span class='n'>PropertyType</span> <span class='p'>==</span> <span class='n'>person1Property</span><span class='p'>.</span><span class='n'>PropertyType</span><span class='p'>)</span>
        <span class='p'>.</span><span class='n'>Name</span><span class='p'>;</span>

    <span class='k'>return</span> <span class='kt'>string</span><span class='p'>.</span><span class='n'>Format</span><span class='p'>(</span><span class='n'>PropertyMapTemplate</span><span class='p'>,</span> <span class='n'>person2PropertyName</span><span class='p'>,</span> <span class='n'>person1Name</span><span class='p'>,</span> <span class='n'>person1PropertyName</span><span class='p'>);</span>
<span class='p'>});</span>

<span class='kt'>var</span> <span class='n'>mappingDeclarations</span> <span class='p'>=</span> <span class='kt'>string</span><span class='p'>.</span><span class='n'>Join</span><span class='p'>(</span><span class='s'>&quot;,&quot;</span> <span class='p'>+</span> <span class='n'>Environment</span><span class='p'>.</span><span class='n'>NewLine</span> <span class='p'>+</span> <span class='s'>&quot;\t\t\t&quot;</span><span class='p'>,</span> <span class='n'>mappings</span><span class='p'>);</span>
<span class='err'>#</span><span class='p'>&gt;</span>
</code></pre></div>
<p>Notice that we are starting out by getting all our components needed to build the class together before actually defining the template code itself. This is a good practice to follow as it makes the template code easier to read and understand.</p>

<p>Finally, let’s define the class template. All we need to do is copy our model code from before and substitute in our person1Name and person2Name const values as variable names, as well as the mappingDeclarations string that we generated with our LINQ statement. To print a variable to the template output, we surround it with tags. The final result looks like this:</p>
<div class='highlight'><pre><code class='csharp'><span class='p'>&lt;</span><span class='err'>#@</span> <span class='n'>template</span> <span class='n'>debug</span><span class='p'>=</span><span class='s'>&quot;false&quot;</span> <span class='n'>hostspecific</span><span class='p'>=</span><span class='s'>&quot;false&quot;</span> <span class='n'>language</span><span class='p'>=</span><span class='s'>&quot;C#&quot;</span> <span class='err'>#</span><span class='p'>&gt;</span>
<span class='p'>&lt;</span><span class='err'>#@</span> <span class='n'>assembly</span> <span class='n'>name</span><span class='p'>=</span><span class='s'>&quot;System.Core&quot;</span> <span class='err'>#</span><span class='p'>&gt;</span>
<span class='p'>&lt;</span><span class='err'>#@</span> <span class='n'>assembly</span> <span class='n'>name</span><span class='p'>=</span><span class='s'>&quot;$(TargetPath)&quot;</span> <span class='err'>#</span><span class='p'>&gt;</span>
<span class='p'>&lt;</span><span class='err'>#@</span> <span class='n'>import</span> <span class='n'>namespace</span><span class='p'>=</span><span class='s'>&quot; MapperApplication&quot;</span> <span class='err'>#</span><span class='p'>&gt;</span>
<span class='p'>&lt;</span><span class='err'>#@</span> <span class='n'>import</span> <span class='n'>namespace</span><span class='p'>=</span><span class='s'>&quot;System.Linq&quot;</span> <span class='err'>#</span><span class='p'>&gt;</span>
<span class='p'>&lt;</span><span class='err'>#@</span> <span class='n'>import</span> <span class='n'>namespace</span><span class='p'>=</span><span class='s'>&quot;System.Text&quot;</span> <span class='err'>#</span><span class='p'>&gt;</span>
<span class='p'>&lt;</span><span class='err'>#@</span> <span class='n'>import</span> <span class='n'>namespace</span><span class='p'>=</span><span class='s'>&quot;System.Collections.Generic&quot;</span> <span class='err'>#</span><span class='p'>&gt;</span>
<span class='p'>&lt;</span><span class='err'>#@</span> <span class='n'>output</span> <span class='n'>extension</span><span class='p'>=</span><span class='s'>&quot;.cs&quot;</span> <span class='err'>#</span><span class='p'>&gt;</span>
<span class='p'>&lt;</span><span class='err'>#</span>
<span class='k'>const</span> <span class='kt'>string</span> <span class='n'>person1Name</span> <span class='p'>=</span> <span class='s'>&quot;person1&quot;</span><span class='p'>;</span>
<span class='k'>const</span> <span class='kt'>string</span> <span class='n'>person2Name</span> <span class='p'>=</span> <span class='s'>&quot;person2&quot;</span><span class='p'>;</span>
<span class='k'>const</span> <span class='kt'>string</span> <span class='n'>PropertyMapTemplate</span> <span class='p'>=</span> <span class='s'>&quot;{0} = {1}.{2}&quot;</span><span class='p'>;</span>

<span class='kt'>var</span> <span class='n'>type1</span> <span class='p'>=</span> <span class='k'>typeof</span><span class='p'>(</span><span class='n'>Person1</span><span class='p'>);</span>
<span class='kt'>var</span> <span class='n'>type2</span> <span class='p'>=</span> <span class='k'>typeof</span><span class='p'>(</span><span class='n'>Person2</span><span class='p'>);</span>
<span class='kt'>var</span> <span class='n'>person1Properties</span> <span class='p'>=</span> <span class='n'>type1</span><span class='p'>.</span><span class='n'>GetProperties</span><span class='p'>();</span>
<span class='kt'>var</span> <span class='n'>person2Properties</span> <span class='p'>=</span> <span class='n'>type2</span><span class='p'>.</span><span class='n'>GetProperties</span><span class='p'>();</span>
<span class='kt'>var</span> <span class='n'>mappings</span> <span class='p'>=</span> <span class='n'>person1Properties</span><span class='p'>.</span><span class='n'>Select</span><span class='p'>(</span><span class='n'>person1Property</span> <span class='p'>=&gt;</span>
    <span class='p'>{</span>
        <span class='kt'>var</span> <span class='n'>person1PropertyName</span> <span class='p'>=</span> <span class='n'>person1Property</span><span class='p'>.</span><span class='n'>Name</span><span class='p'>;</span>
        <span class='kt'>var</span> <span class='n'>person2PropertyName</span> <span class='p'>=</span> <span class='n'>person2Properties</span>
            <span class='p'>.</span><span class='n'>First</span><span class='p'>(</span><span class='n'>person2Property</span> <span class='p'>=&gt;</span> <span class='n'>person2Property</span><span class='p'>.</span><span class='n'>Name</span> <span class='p'>==</span> <span class='n'>person1Property</span><span class='p'>.</span><span class='n'>Name</span>
                <span class='p'>&amp;</span><span class='n'>amp</span><span class='p'>;&amp;</span><span class='n'>amp</span><span class='p'>;</span> <span class='n'>person2Property</span><span class='p'>.</span><span class='n'>PropertyType</span> <span class='p'>==</span> <span class='n'>person1Property</span><span class='p'>.</span><span class='n'>PropertyType</span><span class='p'>)</span>
            <span class='p'>.</span><span class='n'>Name</span><span class='p'>;</span>

        <span class='k'>return</span> <span class='kt'>string</span><span class='p'>.</span><span class='n'>Format</span><span class='p'>(</span><span class='n'>PropertyMapTemplate</span><span class='p'>,</span> <span class='n'>person2PropertyName</span><span class='p'>,</span> <span class='n'>person1Name</span><span class='p'>,</span> <span class='n'>person1PropertyName</span><span class='p'>);</span>
    <span class='p'>});</span>

<span class='kt'>var</span> <span class='n'>mappingDeclarations</span> <span class='p'>=</span> <span class='kt'>string</span><span class='p'>.</span><span class='n'>Join</span><span class='p'>(</span><span class='s'>&quot;,&quot;</span> <span class='p'>+</span> <span class='n'>Environment</span><span class='p'>.</span><span class='n'>NewLine</span> <span class='p'>+</span> <span class='s'>&quot;\t\t\t&quot;</span><span class='p'>,</span> <span class='n'>mappings</span><span class='p'>);</span>
<span class='err'>#</span><span class='p'>&gt;</span>

<span class='k'>namespace</span> <span class='nn'>MapperApplication</span>
<span class='p'>{</span>
    <span class='k'>public</span> <span class='k'>static</span> <span class='k'>class</span> <span class='nc'>Mapper</span>
    <span class='p'>{</span>
        <span class='k'>public</span> <span class='k'>static</span> <span class='p'>&lt;</span><span class='err'>#</span><span class='p'>=</span> <span class='n'>type2</span><span class='p'>.</span><span class='n'>Name</span> <span class='err'>#</span><span class='p'>&gt;</span> <span class='n'>MapTypes</span><span class='p'>(&lt;</span><span class='err'>#</span><span class='p'>=</span> <span class='n'>type1</span><span class='p'>.</span><span class='n'>Name</span> <span class='err'>#</span><span class='p'>&gt;</span> <span class='p'>&lt;</span><span class='err'>#</span><span class='p'>=</span> <span class='n'>person1Name</span> <span class='err'>#</span><span class='p'>&gt;)</span>
        <span class='p'>{</span>
            <span class='k'>return</span> <span class='k'>new</span> <span class='p'>&lt;</span><span class='err'>#</span><span class='p'>=</span> <span class='n'>type2</span><span class='p'>.</span><span class='n'>Name</span> <span class='err'>#</span><span class='p'>&gt;</span>
            <span class='p'>{</span>
                <span class='p'>&lt;</span><span class='err'>#</span><span class='p'>=</span> <span class='n'>mappingDeclarations</span> <span class='err'>#</span><span class='p'>&gt;</span>
            <span class='p'>};</span>
        <span class='p'>}</span>
    <span class='p'>}</span>
<span class='p'>}</span>
</code></pre></div>
<p>Now let’s save the template. Saving it will run the T4 file and generate a code file which will appear as a subcomponent of our .tt file in the solution explorer. This is what the generated code looks like:</p>
<div class='highlight'><pre><code class='csharp'><span class='k'>namespace</span> <span class='nn'>MapperApplication</span>
<span class='p'>{</span>
    <span class='k'>public</span> <span class='k'>static</span> <span class='k'>class</span> <span class='nc'>Mapper</span>
    <span class='p'>{</span>
        <span class='k'>public</span> <span class='k'>static</span> <span class='n'>Person2</span> <span class='nf'>MapTypes</span><span class='p'>(</span><span class='n'>Person1</span> <span class='n'>person1</span><span class='p'>)</span>
        <span class='p'>{</span>
            <span class='k'>return</span> <span class='k'>new</span> <span class='n'>Person2</span>
            <span class='p'>{</span>
                <span class='n'>Name</span> <span class='p'>=</span> <span class='n'>person1</span><span class='p'>.</span><span class='n'>Name</span><span class='p'>,</span>
                <span class='n'>Birthday</span> <span class='p'>=</span> <span class='n'>person1</span><span class='p'>.</span><span class='n'>Birthday</span>
            <span class='p'>};</span>
        <span class='p'>}</span>
    <span class='p'>}</span>
<span class='p'>}</span>
</code></pre></div>
<p>Success!</p>

<p>This may have seemed like a lot of work to go to just to write a simple mapper, but the advantage of templating becomes clear when we modify the Person1 and Person2 classes. Any modifications are carried over to the mapper when the program is recompiled or the mapper is edited. In large projects the automation of tasks like these can save countless hours of refactoring. Happy templating!</p>
                        <br>
                    <span class="entry-tags">
                    <p>
                        <i class="icon-tags"></i>&nbsp;Tagged with <a href="/tags/index.html#c#" data-toggle="tooltip" title="Posts tagged with c#" rel="tag">c#</a>&nbsp;&bull;&nbsp;<a href="/tags/index.html#T4" data-toggle="tooltip" title="Posts tagged with T4" rel="tag">T4</a>
                    </p>
                    </span>
                    </div>
        </div>
                    <footer class="post-footer entry-meta">
                        
                        <div class="post-author text-center">                       
	        <img src="/images/" alt="'s photo" itemprop="image" class="post-avatar img-circle img-responsive"/>    
	    <h4 class="bordered-bottom vcard author" itemprop="author" itemscope itemtype="http://schema.org/Person">By <span itemprop="name" class="fn"><a href="/about" title="About " itemprop="url"></a></span></h4>
	    <p></p>
</div> 
                        
                    </footer>
            </article>
    </div>
</div>

<footer id="footer"  class="blog-background overlay text-center align-middle animated from-top" style="background-image: url(/images/)" >


    <div class="inner">
        <div class="container">

            <ul class="social-icons">
            
            
            
            
            
            
            
            
            
        </ul>
            <p class="copy-text">
                <a href="/about/"></a> &copy; 2014 &bull; All rights reserved.
            </p>
            <p class="copy-text">
                Powered by <a href="http://jekyllrb.com">Jekyll</a> using the <i class="icon-heart"></i> <a href="http://alum.mit.edu/www/hmfaysal/">HMFAYSAL OMEGA</a> theme.
            </p>
            <ul class="menu-items">
            
            <li><a href="/feed.xml" title="Atom/RSS feed"><i class="icon-rss"></i> Feed</a></li>
            
        </ul>
        </div>
    </div>
    
        <div class="decor-wrapper">
            <svg id="footer-decor" class="decor top" xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 100 100" preserveAspectRatio="none">
                <path d="M0 0 L50 50 L100 0 L0 0" fill="rgba(255,255,255, 1)"></path>

                <path d="M48 48 L50 51 L52 48 L48 48" fill="rgba(255,255,255, 1)"></path>

            </svg>
        </div>
    
</footer>

    
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="/assets/js/scripts.min.js"></script>
    
    <script type="text/javascript" src="/assets/js/script.js"></script>



<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = ''; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript> 
</body>
</html>