<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>[Azure/ClearDB] Migrating a MySQL database &#8211; </title>
<meta name="description" content="">
<meta name="keywords" content="azure, mysql, cleardb, migration">



<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="[Azure/ClearDB] Migrating a MySQL database">
<meta property="og:description" content="">
<meta property="og:url" content="/windows%20azure/2014/02/14/azurecleardb-migrating-a-mysql-database.html">
<meta property="og:site_name" content="">
<meta property="og:image" content="/images/">





<link rel="canonical" href="/windows%20azure/2014/02/14/azurecleardb-migrating-a-mysql-database.html">
<link href="/feed.xml" type="application/atom+xml" rel="alternate" title=" Feed">


<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

    
    <link rel="stylesheet" type="text/css" href="/assets/css/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="/assets/css/style.css" />






<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/images/apple-touch-icon-144x144-precomposed.png">

</head>
<body class="post-template" itemscope itemtype="http://schema.org/WebPage">  

<header id="masthead" class="blog-background overlay align-center align-middle animated from-bottom"  style="background-image: url(/images/)" itemscope itemtype="http://schema.org/Organization">


    <div class="inner">
        <div class="container">
            <a class="brand" href="/" role="banner" itemprop="url">

                

            <h1 class="blog-title light" itemprop="name">
                
            </h1>
                
            </a>
        </div>
    </div>
    
    
    <div class="decor-wrapper">
        <svg id="header-decor" class="decor bottom" xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 100 100" preserveAspectRatio="none">
            <path d="M0 99.9 L50 49.9 L100 99.9 L0 99.9" fill="rgba(255,255,255, 1)"></path>

            <path d="M48 52 L50 49 L52 52 L48 52" fill="rgba(255,255,255, 1)"></path>

        </svg>
    </div>
    
</header>
<div id="main" class="content" role="main" itemprop="mainContentOfPage" itemscope itemtype="http://schema.org/Blog">
    <div class="container">
        <div class="row">
            <article class="post col-md-8 col-md-offset-2 hentry" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
            
            
            
                
            
             
             
                    <header class="post-header entry-header">
                        
                        <h1 class="post-title text-center hyper lighter bordered-bottom entry-title" itemprop="headline">[Azure/ClearDB] Migrating a MySQL database</h1>
                        
                        <div class="post-info text-center small">
                            <span class="entry-date date published updated"><time datetime="2014-02-14T00:00:00+01:00" class="post-time" itemprop="datePublished">14 Feb 2014</time><span>
                            in <span class="post-tags"><a href="/categories/index.html#windows azure" data-toggle="tooltip" title="Other posts from the Windows azure category" rel="tag">Windows azure</a></span>
                        </div>
                    </header>
                    <div class="post-body bordered-bottom" itemprop="description">
                        
                        <h2 id="disclaimer">Disclaimer</h2>

<p><em>I make no guarantees about the reliability of this migration procedure. This is the process that I followed, and while it did work for me that does not in any way mean that you will obtain the same results. In short, use at your own risk.</em></p>

<h2 id="the_strategy">The strategy</h2>

<p>I recently had to migrate this blog from one Azure account to another. While the site migration wasn’t terribly fascinating, the database migration was a task unto itself. Because Microsoft provides MySQL databases to Azure users via a third party (ClearDB), they do not support migrating MySQL databases like they do web roles, SQL server databases, and the like. I therefore had to manage the migration myself. This is how I did it.</p>
<ol>
<li>Create a new database in the target Azure account to migrate to</li>
<li>Get the credentials for the origin and target databases</li>
<li>Run a migration script</li>
</ol>
<p>Step 1 is fairly simple and needs no explanation. Steps 2 and 3, however, are worth looking at in greater depth.</p>

<h2 id="getting_to_the_database">Getting to the database</h2>

<p>The first step to migrating the database is getting the required credentials. Specifically, the following information is required:</p>
<ul>
<li>Database name</li>
<li>Host name</li>
<li>Username</li>
<li>Password</li>
</ul>
<p>You can get these values by logging in to the Windows Azure management portal, finding the entry for the MySQL database (in my case it was a “Linked Resource” associated with my Azure Web Site) and clicking on the DB name. This will take you to the ClearDB website. Click on the <strong>Endpoint Information</strong> tab, and voilà.</p>

<p><a href="http://www.levibotelho.com/wp-content/uploads/2014/02/Migrating-ClearDB.png"></a></p>

<h2 id="the_script">The script</h2>

<p>In order to perform the actual migration, you’ll need mysqldump.exe on your machine. If you have MySQL installed, you’ll be able to find it at <strong>C:\Program Files\MySQL\MySQL Server 5.5\bin</strong>. Open a command prompt, navigate to the directory where mysqldump lives, and then execute the following command:</p>

<blockquote>
<p>mysqldump –single-transaction -u <strong>[Origin Username]</strong> –p<strong>[Origin Password]</strong> -h <strong>[Origin Hostname]</strong> <strong>[Origin Database Name]</strong> | mysql -h <strong>[Target Hostname]</strong> -u <strong>[Target Username]</strong> –p<strong>[Target Password]</strong> -D <strong>[Target Database]</strong></p>
</blockquote>

<p>Don’t worry, I too got a headache when I first laid eyes on it. There are three things that I must note about this before continuing on.</p>
<ul>
<li>There is no space between the `–p` switch and the database password. That is intentional.</li>
<li>[This command will apparently delete data not covered by the backup in the target database](http://stackoverflow.com/q/5475200/1068266). I have assumed here that you are backing up to a new database containing no prior data.</li>
<li>I understand that it is often considered bad practice to embed the password directly in the command as I have done here. However, when I included just the password switch without supplying a password, the command line prompted me for the passwords to both databases simultaneously which understandably resulted in an error. I’m no DBA, so it’s perfectly possible that there is a way around this. If you know of one, leave a comment!</li>
</ul>
<p>Anyways, launch the command with the arguments specified, and if your database isn’t too large, in a matter of minutes all your data will, with a little luck, have successfully been migrated from one database to another.</p>

<h2 id="a_word_on_azure_migration">A word on Azure migration</h2>

<p>If you ask Microsoft to migrate your Azure resources from one account to another, they will kindly inform you that the target account must be empty. They will also inform you that your MySQL database will be lost in the migration process (at least that’s what they told me). What this means for you, the account owner, is that you basically have two migration strategies to consider.</p>
<ol>
<li>Migrate everything yourself, and delete the old stuff when you’re done.</li>
<li>Migrate your MySQL database to a backup DB, get Microsoft to perform the rest of the migration, and then perform the MySQL migration process once more to restore the backup to your new account.</li>
</ol>
<p>In my case I chose option 1, but the decision is an important one and needs to be made on a case-by-case basis. If you’re in a similar scenario, be sure to give this some thought, and in all cases be sure to back up liberally so that you’re covered just in case things go haywire halfway through.</p>

<p>Good luck, and happy migration!</p>
                        <br>
                    <span class="entry-tags">
                    <p>
                        <i class="icon-tags"></i>&nbsp;Tagged with <a href="/tags/index.html#azure" data-toggle="tooltip" title="Posts tagged with azure" rel="tag">azure</a>&nbsp;&bull;&nbsp;<a href="/tags/index.html#mysql" data-toggle="tooltip" title="Posts tagged with mysql" rel="tag">mysql</a>&nbsp;&bull;&nbsp;<a href="/tags/index.html#cleardb" data-toggle="tooltip" title="Posts tagged with cleardb" rel="tag">cleardb</a>&nbsp;&bull;&nbsp;<a href="/tags/index.html#migration" data-toggle="tooltip" title="Posts tagged with migration" rel="tag">migration</a>
                    </p>
                    </span>
                    </div>
        </div>
                    <footer class="post-footer entry-meta">
                        
                        <div class="post-author text-center">                       
	        <img src="/images/" alt="'s photo" itemprop="image" class="post-avatar img-circle img-responsive"/>    
	    <h4 class="bordered-bottom vcard author" itemprop="author" itemscope itemtype="http://schema.org/Person">By <span itemprop="name" class="fn"><a href="/about" title="About " itemprop="url"></a></span></h4>
	    <p></p>
</div> 
                        
                    </footer>
            </article>
    </div>
</div>

<footer id="footer"  class="blog-background overlay text-center align-middle animated from-top" style="background-image: url(/images/)" >


    <div class="inner">
        <div class="container">

            <ul class="social-icons">
            
            
            
            
            
            
            
            
            
        </ul>
            <p class="copy-text">
                <a href="/about/"></a> &copy; 2014 &bull; All rights reserved.
            </p>
            <p class="copy-text">
                Powered by <a href="http://jekyllrb.com">Jekyll</a> using the <i class="icon-heart"></i> <a href="http://alum.mit.edu/www/hmfaysal/">HMFAYSAL OMEGA</a> theme.
            </p>
            <ul class="menu-items">
            
            <li><a href="/feed.xml" title="Atom/RSS feed"><i class="icon-rss"></i> Feed</a></li>
            
        </ul>
        </div>
    </div>
    
        <div class="decor-wrapper">
            <svg id="footer-decor" class="decor top" xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 100 100" preserveAspectRatio="none">
                <path d="M0 0 L50 50 L100 0 L0 0" fill="rgba(255,255,255, 1)"></path>

                <path d="M48 48 L50 51 L52 48 L48 48" fill="rgba(255,255,255, 1)"></path>

            </svg>
        </div>
    
</footer>

    
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="/assets/js/scripts.min.js"></script>
    
    <script type="text/javascript" src="/assets/js/script.js"></script>



<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = ''; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript> 
</body>
</html>