<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Encrypting a web.config file &#8211; </title>
<meta name="description" content="">
<meta name="keywords" content="c#, iis, web.config, deployment">



<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Encrypting a web.config file">
<meta property="og:description" content="">
<meta property="og:url" content="/deployment/2013/04/17/encrypting-a-web-config-file.html">
<meta property="og:site_name" content="">
<meta property="og:image" content="/images/">





<link rel="canonical" href="/deployment/2013/04/17/encrypting-a-web-config-file.html">
<link href="/feed.xml" type="application/atom+xml" rel="alternate" title=" Feed">


<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

    
    <link rel="stylesheet" type="text/css" href="/assets/css/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="/assets/css/style.css" />






<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/images/apple-touch-icon-144x144-precomposed.png">

</head>
<body class="post-template" itemscope itemtype="http://schema.org/WebPage">  

<header id="masthead" class="blog-background overlay align-center align-middle animated from-bottom"  style="background-image: url(/images/)" itemscope itemtype="http://schema.org/Organization">


    <div class="inner">
        <div class="container">
            <a class="brand" href="/" role="banner" itemprop="url">

                

            <h1 class="blog-title light" itemprop="name">
                
            </h1>
                
            </a>
        </div>
    </div>
    
    
    <div class="decor-wrapper">
        <svg id="header-decor" class="decor bottom" xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 100 100" preserveAspectRatio="none">
            <path d="M0 99.9 L50 49.9 L100 99.9 L0 99.9" fill="rgba(255,255,255, 1)"></path>

            <path d="M48 52 L50 49 L52 52 L48 52" fill="rgba(255,255,255, 1)"></path>

        </svg>
    </div>
    
</header>
<div id="main" class="content" role="main" itemprop="mainContentOfPage" itemscope itemtype="http://schema.org/Blog">
    <div class="container">
        <div class="row">
            <article class="post col-md-8 col-md-offset-2 hentry" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
            
            
            
                
            
             
             
                    <header class="post-header entry-header">
                        
                        <h1 class="post-title text-center hyper lighter bordered-bottom entry-title" itemprop="headline">Encrypting a web.config file</h1>
                        
                        <div class="post-info text-center small">
                            <span class="entry-date date published updated"><time datetime="2013-04-17T00:00:00+02:00" class="post-time" itemprop="datePublished">17 Apr 2013</time><span>
                            in <span class="post-tags"><a href="/categories/index.html#deployment" data-toggle="tooltip" title="Other posts from the Deployment category" rel="tag">Deployment</a></span>
                        </div>
                    </header>
                    <div class="post-body bordered-bottom" itemprop="description">
                        
                        <h2 id="1_publish_your_web_application_to_iis">1. Publish your web application to IIS</h2>

<h2 id="2_determine_the_identity_of_your_application">2. Determine the identity of your application</h2>

<p>This is often going to be <code>IIS APPPOOL[Your application pool name]&lt;/strong&gt;. Mine for example is &lt;strong&gt;“IIS APPPOOLDefaultAppPool</code>. If you wish to verify this, it is accessible via the following line of code:</p>
<div class='highlight'><pre><code class='csharp'> <span class='n'>System</span><span class='p'>.</span><span class='n'>Security</span><span class='p'>.</span><span class='n'>Principal</span><span class='p'>.</span><span class='n'>WindowsIdentity</span><span class='p'>.</span><span class='n'>GetCurrent</span><span class='p'>().</span><span class='n'>Name</span>
</code></pre></div>
<h2 id="3_grant_aspnet_read_access_to_the_rsa_key_container">3. Grant ASP.NET read access to the RSA key container</h2>

<p>The RSA key container contains the RSA key data that is used to encrypt and decrypt the web.config file. ASP.NET needs to be able to access the key container in order to perform this operation. To grant access, open the command prompt as administrator and navigate to the following directory:</p>

<p><strong>C:WindowsMicrosoft.NETFramework[.NET Framework Version]</strong></p>

<p>Then, execute the following command:</p>
<div class='highlight'><pre><code class='powershell'> <span class='n'>aspnet_regiis</span> <span class='err'>–</span><span class='n'>pa</span> <span class='err'>“</span><span class='n'>NetFrameworkConfigurationKey</span><span class='err'>”</span> <span class='err'>“</span><span class='no'>[Your application identity]</span><span class='err'>”</span>
</code></pre></div>
<p>Don’t forget the quotation marks around the final two values. If this fails, you may have forgotten to run the command prompt as administrator. Keep your command prompt open. <a id='more' /><a id='more-52' /></p>

<h2 id="4_generate_the_keys">4. Generate the keys</h2>

<p>The keys for encryption and decryption need to be generated and written to your web.config file. This is done after the application is published to IIS. In IIS8 generating keys is easy. Simply navigate to your website in the IIS manager and click on “Machine Key”.</p>

<p><a href="http://thepragmaticdeveloper.files.wordpress.com/2013/01/wc1.png"></a></p>

<p>Then in the following window in the “Actions” bar on the right, click “Generate Keys”, followed by “Apply”.</p>

<p><a href="http://thepragmaticdeveloper.files.wordpress.com/2013/01/wc2.png"></a></p>

<p>Now, open your deployed web.config file and verify that there is an entry called</p>
<div class='highlight'><pre><code class='xml'>
</code></pre></div>
<p>What this does is insert a key into the web.config file of the selected application, allowing its sections to be encrypted and decrypted by IIS.</p>

<h2 id="5_encrypt_the_data">5. Encrypt the data</h2>

<p>Go back to the command prompt that you used to grant access to the RSA container. Type the following command:</p>
<div class='highlight'><pre><code class='powershell'><span class='n'>aspnet_regiis</span> <span class='n'>-pe</span> <span class='err'>“</span><span class='no'>[Path to the config element]</span><span class='err'>”</span> <span class='n'>-app</span> <span class='err'>“</span><span class='p'>/</span><span class='no'>[Virtual path to your application]</span><span class='err'>”</span>
</code></pre></div>
<p>Again, don’t forget the quotation marks. <span style='line-height:1.6;'>This command does two main things :</span></p>
<ol>
<li>Looks in the configuration file of the given application for the given configuration element and encrypts it.</li>
<li>Specifies to ASP.NET that this element in this application needs to be decrypted before it is accessed.</li>
</ol>
<p>Once you have finished encrypting the desired sections, you need to finish by encrypting the machine key. Do this by passing <code>system.web/machineKey</code> as the first argument to the above command.</p>

<p>That’s all there is to it. IIS will be able to read the encrypted configuration settings and your sensitive data will be obscured from anybody who has access to the web.config. Should you ever need to decrypt a section, simply run the encryption command, specifying <strong>-pd</strong> instead of <strong>-pe</strong>.</p>
                        <br>
                    <span class="entry-tags">
                    <p>
                        <i class="icon-tags"></i>&nbsp;Tagged with <a href="/tags/index.html#c#" data-toggle="tooltip" title="Posts tagged with c#" rel="tag">c#</a>&nbsp;&bull;&nbsp;<a href="/tags/index.html#iis" data-toggle="tooltip" title="Posts tagged with iis" rel="tag">iis</a>&nbsp;&bull;&nbsp;<a href="/tags/index.html#web.config" data-toggle="tooltip" title="Posts tagged with web.config" rel="tag">web.config</a>&nbsp;&bull;&nbsp;<a href="/tags/index.html#deployment" data-toggle="tooltip" title="Posts tagged with deployment" rel="tag">deployment</a>
                    </p>
                    </span>
                    </div>
        </div>
                    <footer class="post-footer entry-meta">
                        
                        <div class="post-author text-center">                       
	        <img src="/images/" alt="'s photo" itemprop="image" class="post-avatar img-circle img-responsive"/>    
	    <h4 class="bordered-bottom vcard author" itemprop="author" itemscope itemtype="http://schema.org/Person">By <span itemprop="name" class="fn"><a href="/about" title="About " itemprop="url"></a></span></h4>
	    <p></p>
</div> 
                        
                    </footer>
            </article>
    </div>
</div>

<footer id="footer"  class="blog-background overlay text-center align-middle animated from-top" style="background-image: url(/images/)" >


    <div class="inner">
        <div class="container">

            <ul class="social-icons">
            
            
            
            
            
            
            
            
            
        </ul>
            <p class="copy-text">
                <a href="/about/"></a> &copy; 2014 &bull; All rights reserved.
            </p>
            <p class="copy-text">
                Powered by <a href="http://jekyllrb.com">Jekyll</a> using the <i class="icon-heart"></i> <a href="http://alum.mit.edu/www/hmfaysal/">HMFAYSAL OMEGA</a> theme.
            </p>
            <ul class="menu-items">
            
            <li><a href="/feed.xml" title="Atom/RSS feed"><i class="icon-rss"></i> Feed</a></li>
            
        </ul>
        </div>
    </div>
    
        <div class="decor-wrapper">
            <svg id="footer-decor" class="decor top" xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 100 100" preserveAspectRatio="none">
                <path d="M0 0 L50 50 L100 0 L0 0" fill="rgba(255,255,255, 1)"></path>

                <path d="M48 48 L50 51 L52 48 L48 48" fill="rgba(255,255,255, 1)"></path>

            </svg>
        </div>
    
</footer>

    
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="/assets/js/scripts.min.js"></script>
    
    <script type="text/javascript" src="/assets/js/script.js"></script>



<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = ''; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript> 
</body>
</html>